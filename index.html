<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Law for the Riemann Hypothesis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 15px;
        }

        .phase-law-formula {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }

        .interactive-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .control-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .control-group input, .control-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: scale(1.05);
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .theory-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .theory-section h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .phase-visualization {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .phase-visualization.spiral {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .phase-visualization.amplitude {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-end;
        }

        .phase-circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            transition: all 0.5s ease;
            cursor: pointer;
            position: relative;
            font-size: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-circle:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .phase-circle::after {
            content: attr(data-info);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .phase-circle:hover::after {
            opacity: 1;
        }

        .prime-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .prime-table th, .prime-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .prime-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        .prime-table tr:hover {
            background: #f8f9fa;
        }

        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px dashed #667eea;
        }

        .mathematical-details {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
        }

        .mathematical-details h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .formula-box {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .convergence-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .convergence-good { background: #28a745; }
        .convergence-warning { background: #ffc107; }
        .convergence-poor { background: #dc3545; }

        .detail-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .detail-card h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .computation-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .export-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .computing {
            animation: pulse 1s infinite;
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .controls {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Phase Law for the Riemann Hypothesis</h1>
            <p>Interactive Explorer of Möbius Exponential Sums and Phase Cancellation</p>
            
            <div class="phase-law-formula">
                <strong>Phase Law Conjecture:</strong><br>
                𝒞(N,α) = |S(N,α)|/√N ≪ (log N)^A<br>
                where S(N,α) = Σ<sub>n≤N</sub> μ(n)e<sup>2πinα</sup><br>
                <small style="color: #6c757d; display: block; margin-top: 10px;">
                    This conjectures that Möbius exponential sums exhibit uniform phase cancellation across all frequencies α,
                    with the cancellation ratio growing at most polylogarithmically in N.
                </small>
            </div>
            
            <div style="background: rgba(108, 117, 125, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                <strong>Key Insight:</strong> The critical line σ = ½ represents optimal "phase balance" where prime oscillators 
                e<sup>-itk log p</sup> achieve maximum destructive interference without amplitude decay becoming too rapid or too slow.
            </div>
        </div>

        <div class="interactive-section">
            <h2 class="section-title">🔬 Phase Cancellation Calculator</h2>
            <p style="margin-bottom: 20px; color: #6c757d;">
                Compute the phase-cancellation ratio 𝒞(N,α) = |S(N,α)|/√N for different values of N and frequency α.
                The Phase Law conjectures this ratio grows at most like (log N)^A uniformly in α.
            </p>
            
            <div class="controls">
                <div class="control-group">
                    <label for="maxN">Maximum N (summation limit):</label>
                    <input type="number" id="maxN" min="10" max="2000" value="100" step="10">
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Controls the upper limit of the Möbius sum Σ<sub>n≤N</sub> μ(n)e<sup>2πinα</sup>
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="alpha">Frequency α (phase parameter):</label>
                    <input type="number" id="alpha" min="0" max="1" value="0" step="0.001">
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Real frequency parameter. α = 0 gives Mertens function M(N) = Σμ(n)
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="mode">Analysis Mode:</label>
                    <select id="mode">
                        <option value="single">Single Frequency Analysis</option>
                        <option value="sweep">Frequency Sweep (α ∈ [0,1])</option>
                        <option value="critical">Critical Rational Points</option>
                        <option value="convergence">N-Convergence Study</option>
                    </select>
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Choose analysis type: single point, uniform sweep, or special frequencies
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="precision">Computational Precision:</label>
                    <select id="precision">
                        <option value="fast">Fast (10 points)</option>
                        <option value="medium">Medium (50 points)</option>
                        <option value="high">High (200 points)</option>
                        <option value="ultra">Ultra (1000 points)</option>
                    </select>
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Higher precision = more data points but slower computation
                    </small>
                </div>
                
                <div class="control-group">
                    <button class="btn" onclick="computePhaselaw()">🧮 Calculate</button>
                    <button class="btn" onclick="visualizePhases()">👁️ Update Visualization</button>
                    <button class="btn" onclick="runBenchmark()">⚡ Performance Test</button>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="phaseLawChart"></canvas>
            </div>

            <div class="results-grid" id="resultsGrid">
                <!-- Results will be populated dynamically -->
            </div>
            
            <div class="export-section" id="exportSection" style="display: none;">
                <h4>📊 Export Computed Data</h4>
                <p>Download CSV files containing all computed values for external analysis in Mathematica, Python, or other tools.</p>
                <div id="downloadLinks"></div>
            </div>
        </div>

        <div class="interactive-section">
            <h2 class="section-title">🌊 Prime Oscillator Visualization</h2>
            <p style="margin-bottom: 15px;">
                Each circle represents a prime p contributing the phase oscillator e<sup>-itk log p</sup> to log ζ(s). 
                Circle size reflects amplitude 1/(k·p<sup>kσ</sup>), color shows phase angle, position varies by layout mode.
            </p>
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>Mathematical Context:</strong> In the Euler product expansion, each prime p generates oscillatory terms
                with frequencies k log p and amplitudes 1/(k·p<sup>kσ</sup>). The critical line σ = ½ balances these amplitudes
                optimally for destructive interference. Hover over circles for detailed phase information.
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="maxPrime">Show primes up to:</label>
                    <input type="number" id="maxPrime" min="10" max="1000" value="100" step="10">
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Maximum prime to include in oscillator visualization (affects computation time)
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="vizMode">Visualization Layout:</label>
                    <select id="vizMode">
                        <option value="grid">Grid Layout (organized)</option>
                        <option value="spiral">Prime Spiral (phase-based)</option>
                        <option value="amplitude">By Amplitude (size-sorted)</option>
                        <option value="phase">By Phase Angle (color-sorted)</option>
                    </select>
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Different arrangements highlight various mathematical relationships
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="sigmaBound">σ Parameter (Re(s)):</label>
                    <input type="number" id="sigmaBound" min="0.1" max="2" value="0.5" step="0.1">
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Real part of s = σ + it. σ = ½ is the critical line, σ = 1 is the line of convergence
                    </small>
                </div>
                
                <div class="control-group">
                    <label for="showDetails">Detail Level:</label>
                    <select id="showDetails">
                        <option value="basic">Basic Info</option>
                        <option value="detailed">Detailed Analysis</option>
                        <option value="research">Research Mode</option>
                    </select>
                    <small style="color: #6c757d; margin-top: 5px; display: block;">
                        Controls amount of mathematical detail displayed
                    </small>
                </div>
                
                <div class="control-group">
                    <button class="btn" onclick="exportCSV()">📊 Export Prime Data</button>
                    <button class="btn" onclick="exportFullAnalysis()">📈 Export Full Analysis</button>
                    <button class="btn" onclick="exportResearchData()">🔬 Export Research Dataset</button>
                </div>
            </div>
            
            <div class="phase-visualization" id="phaseVisualization">
                <!-- Phase circles will be generated dynamically -->
            </div>
            
            <div class="prime-info" id="primeInfo" style="margin-top: 20px;">
                <!-- Prime information table will be displayed here -->
            </div>
            
            <div class="mathematical-details" id="mathDetails" style="margin-top: 20px;">
                <!-- Detailed mathematical analysis will be shown here -->
            </div>
        </div>

        <div class="theory-section">
            <h3>🎯 The Euler-Phase Interpretation</h3>
            <p>The critical line σ = ½ represents the unique "phase-balance" locus where prime oscillators 
            e<sup>-itk log p</sup> with amplitudes 1/(k·p<sup>kσ</sup>) achieve optimal destructive interference. 
            Each prime contributes a phase oscillator, and nontrivial zeros correspond to perfect synchrony 
            across all oscillators.</p>
            
            <div class="phase-law-formula" style="background: rgba(255,255,255,0.1); color: white;">
                log ζ(s) = Σ<sub>p</sub> Σ<sub>k≥1</sub> [1/(k·p<sup>kσ</sup>)] · e<sup>-itk log p</sup>
            </div>
        </div>

        <div class="footer">
            <p>Interactive exploration of the Phase Law conjecture for the Riemann Hypothesis</p>
            <p>Investigating uniform phase cancellation in Möbius exponential sums</p>
        </div>
    </div>

    <script>
        // Möbius function implementation
        function mobius(n) {
            if (n === 1) return 1;
            
            let factors = [];
            let temp = n;
            
            for (let i = 2; i * i <= temp; i++) {
                let count = 0;
                while (temp % i === 0) {
                    temp /= i;
                    count++;
                }
                if (count > 1) return 0; // squared prime factor
                if (count === 1) factors.push(i);
            }
            
            if (temp > 1) factors.push(temp);
            
            return factors.length % 2 === 0 ? 1 : -1;
        }

        // Compute Möbius exponential sum
        function computeMobiusSum(N, alpha) {
            let realPart = 0;
            let imagPart = 0;
            
            for (let n = 1; n <= N; n++) {
                const mu = mobius(n);
                const phase = 2 * Math.PI * n * alpha;
                realPart += mu * Math.cos(phase);
                imagPart += mu * Math.sin(phase);
            }
            
            return {
                real: realPart,
                imag: imagPart,
                magnitude: Math.sqrt(realPart * realPart + imagPart * imagPart)
            };
        }

        // Compute phase cancellation ratio
        function phaseCancellationRatio(N, alpha) {
            const sum = computeMobiusSum(N, alpha);
            return sum.magnitude / Math.sqrt(N);
        }

        let chart = null;

        function computePhaselaw() {
            const maxN = parseInt(document.getElementById('maxN').value);
            const alpha = parseFloat(document.getElementById('alpha').value);
            const mode = document.getElementById('mode').value;
            
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '';
            
            if (mode === 'single') {
                computeSingleFrequency(maxN, alpha);
            } else if (mode === 'sweep') {
                computeFrequencySweep(maxN);
            } else if (mode === 'critical') {
                computeCriticalPoints(maxN);
            }
        }

        function computeSingleFrequency(maxN, alpha) {
            const data = [];
            const labels = [];
            
            for (let N = 10; N <= maxN; N += Math.max(1, Math.floor(maxN / 50))) {
                const ratio = phaseCancellationRatio(N, alpha);
                data.push(ratio);
                labels.push(N);
            }
            
            // Update chart
            updateChart(labels, data, `Phase Cancellation Ratio vs N (α = ${alpha})`);
            
            // Show results
            const finalRatio = data[data.length - 1];
            const theoreticalBound = Math.pow(Math.log(maxN), 1.5); // Assumed A = 1.5
            
            showResults([
                { label: `𝒞(${maxN}, ${alpha})`, value: finalRatio.toFixed(4) },
                { label: 'Theoretical Bound', value: theoreticalBound.toFixed(4) },
                { label: 'Ratio/Bound', value: (finalRatio / theoreticalBound).toFixed(4) },
                { label: 'Growth Rate', value: `∼ (log N)^${Math.log(finalRatio) / Math.log(Math.log(maxN))}`}
            ]);
        }

        function computeFrequencySweep(maxN) {
            const data = [];
            const labels = [];
            const alphaSteps = 100;
            
            for (let i = 0; i <= alphaSteps; i++) {
                const alpha = i / alphaSteps;
                const ratio = phaseCancellationRatio(maxN, alpha);
                data.push(ratio);
                labels.push(alpha.toFixed(3));
            }
            
            updateChart(labels, data, `Phase Cancellation vs Frequency (N = ${maxN})`);
            
            const maxRatio = Math.max(...data);
            const avgRatio = data.reduce((a, b) => a + b) / data.length;
            
            showResults([
                { label: 'Max Ratio', value: maxRatio.toFixed(4) },
                { label: 'Average Ratio', value: avgRatio.toFixed(4) },
                { label: 'N Value', value: maxN },
                { label: 'Frequencies Tested', value: alphaSteps + 1 }
            ]);
        }

        function computeCriticalPoints(maxN) {
            const criticalAlphas = [0, 1/6, 1/4, 1/3, 1/2, 2/3, 3/4, 5/6];
            const data = [];
            const labels = [];
            
            criticalAlphas.forEach(alpha => {
                const ratio = phaseCancellationRatio(maxN, alpha);
                data.push(ratio);
                labels.push(`α = ${alpha.toFixed(3)}`);
            });
            
            updateChart(labels, data, `Critical Frequency Points (N = ${maxN})`, 'bar');
            
            const worstCase = Math.max(...data);
            const atZero = data[0]; // α = 0 case
            
            showResults([
                { label: 'Worst Case', value: worstCase.toFixed(4) },
                { label: 'At α = 0', value: atZero.toFixed(4) },
                { label: 'N Value', value: maxN },
                { label: 'Points Tested', value: criticalAlphas.length }
            ]);
        }

        function updateChart(labels, data, title, type = 'line') {
            const ctx = document.getElementById('phaseLawChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Phase Cancellation Ratio',
                        data: data,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: type === 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '𝒞(N,α)'
                            }
                        }
                    }
                }
            });
        }

        function showResults(results) {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = results.map(result => `
                <div class="result-card">
                    <div class="result-value">${result.value}</div>
                    <div class="result-label">${result.label}</div>
                </div>
            `).join('');
        }

        // Generate all primes up to n using Sieve of Eratosthenes
        function generatePrimes(n) {
            const sieve = new Array(n + 1).fill(true);
            sieve[0] = sieve[1] = false;
            
            for (let i = 2; i * i <= n; i++) {
                if (sieve[i]) {
                    for (let j = i * i; j <= n; j += i) {
                        sieve[j] = false;
                    }
                }
            }
            
            return sieve.map((isPrime, num) => isPrime ? num : null)
                       .filter(num => num !== null);
        }

        // Compute comprehensive prime data
        function computePrimeData(maxPrime, alpha, N) {
            const primes = generatePrimes(maxPrime);
            const t = alpha * N; // Scale t parameter
            
            return primes.map(p => {
                const phase = (t * Math.log(p)) % (2 * Math.PI);
                const phaseDegrees = (phase * 180 / Math.PI);
                const amplitude = 1 / Math.sqrt(p); // Simplified amplitude weighting
                const realContrib = amplitude * Math.cos(phase);
                const imagContrib = amplitude * Math.sin(phase);
                
                return {
                    prime: p,
                    phase: phase,
                    phaseDegrees: phaseDegrees,
                    amplitude: amplitude,
                    realContribution: realContrib,
                    imagContribution: imagContrib,
                    magnitude: amplitude
                };
            });
        }

        // Export CSV functionality
        function exportCSV() {
            const maxPrime = parseInt(document.getElementById('maxPrime').value);
            const alpha = parseFloat(document.getElementById('alpha').value);
            const N = parseInt(document.getElementById('maxN').value);
            
            const primeData = computePrimeData(maxPrime, alpha, N);
            
            // Create CSV content
            let csvContent = "Prime,Phase_Radians,Phase_Degrees,Amplitude,Real_Contribution,Imaginary_Contribution,Magnitude\n";
            
            primeData.forEach(data => {
                csvContent += `${data.prime},${data.phase.toFixed(6)},${data.phaseDegrees.toFixed(2)},${data.amplitude.toFixed(6)},${data.realContribution.toFixed(6)},${data.imagContribution.toFixed(6)},${data.magnitude.toFixed(6)}\n`;
            });
            
            downloadCSV(csvContent, `phase_oscillators_N${N}_alpha${alpha.toFixed(3)}.csv`);
        }

        function exportFullAnalysis() {
            const maxN = parseInt(document.getElementById('maxN').value);
            const maxPrime = parseInt(document.getElementById('maxPrime').value);
            
            let csvContent = "N,Alpha,Phase_Cancellation_Ratio,Mobius_Sum_Real,Mobius_Sum_Imag,Mobius_Sum_Magnitude,Theoretical_Bound\n";
            
            // Frequency sweep for full analysis
            for (let N = 10; N <= maxN; N += Math.max(1, Math.floor(maxN / 20))) {
                for (let i = 0; i <= 20; i++) {
                    const alpha = i / 20;
                    const sum = computeMobiusSum(N, alpha);
                    const ratio = sum.magnitude / Math.sqrt(N);
                    const theoreticalBound = Math.pow(Math.log(N), 1.5);
                    
                    csvContent += `${N},${alpha.toFixed(3)},${ratio.toFixed(6)},${sum.real.toFixed(6)},${sum.imag.toFixed(6)},${sum.magnitude.toFixed(6)},${theoreticalBound.toFixed(6)}\n`;
                }
            }
            
            downloadCSV(csvContent, `phase_law_full_analysis_N${maxN}.csv`);
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function visualizePhases() {
            const phaseViz = document.getElementById('phaseVisualization');
            const maxPrime = parseInt(document.getElementById('maxPrime').value);
            const alpha = parseFloat(document.getElementById('alpha').value);
            const N = parseInt(document.getElementById('maxN').value);
            const vizMode = document.getElementById('vizMode').value;
            
            const primeData = computePrimeData(maxPrime, alpha, N);
            
            // Clear previous visualization
            phaseViz.innerHTML = '';
            phaseViz.className = `phase-visualization ${vizMode}`;
            
            if (vizMode === 'spiral') {
                visualizeSpiral(phaseViz, primeData);
            } else if (vizMode === 'amplitude') {
                visualizeByAmplitude(phaseViz, primeData);
            } else {
                visualizeGrid(phaseViz, primeData);
            }
            
            // Update prime information table
            updatePrimeTable(primeData.slice(0, 20)); // Show first 20 primes in detail
        }

        function visualizeGrid(container, primeData) {
            container.innerHTML = primeData.map((data, i) => {
                const hue = (data.phaseDegrees + 360) % 360;
                const size = Math.max(50, 90 * data.amplitude * 10); // Scale for visibility
                
                return `
                    <div class="phase-circle" 
                         style="background: hsl(${hue}, 70%, 60%); 
                                width: ${size}px; height: ${size}px;
                                transform: rotate(${data.phaseDegrees}deg);"
                         data-info="φ=${data.phaseDegrees.toFixed(1)}°, A=${data.amplitude.toFixed(3)}"
                         title="Prime: ${data.prime}, Phase: ${data.phaseDegrees.toFixed(1)}°, Amplitude: ${data.amplitude.toFixed(4)}">
                        ${data.prime}
                    </div>
                `;
            }).join('');
        }

        function visualizeSpiral(container, primeData) {
            const centerX = 300;
            const centerY = 300;
            container.style.position = 'relative';
            container.style.width = '600px';
            container.style.height = '600px';
            container.style.margin = '0 auto';
            
            container.innerHTML = primeData.map((data, i) => {
                const radius = 50 + i * 8; // Spiral outward
                const angle = data.phase;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                const hue = (data.phaseDegrees + 360) % 360;
                const size = Math.max(30, 50 * data.amplitude * 10);
                
                return `
                    <div class="phase-circle" 
                         style="background: hsl(${hue}, 70%, 60%); 
                                width: ${size}px; height: ${size}px;
                                position: absolute;
                                left: ${x - size/2}px;
                                top: ${y - size/2}px;"
                         data-info="φ=${data.phaseDegrees.toFixed(1)}°"
                         title="Prime: ${data.prime}, Phase: ${data.phaseDegrees.toFixed(1)}°">
                        ${data.prime}
                    </div>
                `;
            }).join('');
        }

        function visualizeByAmplitude(container, primeData) {
            // Sort by amplitude (descending)
            const sortedData = [...primeData].sort((a, b) => b.amplitude - a.amplitude);
            
            container.innerHTML = sortedData.map((data, i) => {
                const hue = (data.phaseDegrees + 360) % 360;
                const size = Math.max(40, 120 * data.amplitude * 10);
                
                return `
                    <div class="phase-circle" 
                         style="background: hsl(${hue}, 70%, 60%); 
                                width: ${size}px; height: ${size}px;"
                         data-info="A=${data.amplitude.toFixed(4)}"
                         title="Prime: ${data.prime}, Amplitude: ${data.amplitude.toFixed(4)}, Phase: ${data.phaseDegrees.toFixed(1)}°">
                        ${data.prime}
                    </div>
                `;
            }).join('');
        }

        function updatePrimeTable(primeData) {
            const primeInfo = document.getElementById('primeInfo');
            
            if (primeData.length === 0) return;
            
            const tableHTML = `
                <h3 style="margin-bottom: 15px; color: #2c3e50;">Prime Oscillator Details (First 20)</h3>
                <table class="prime-table">
                    <thead>
                        <tr>
                            <th>Prime</th>
                            <th>Phase (°)</th>
                            <th>Amplitude</th>
                            <th>Real Contrib</th>
                            <th>Imag Contrib</th>
                            <th>Magnitude</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${primeData.map(data => `
                            <tr>
                                <td style="font-weight: bold;">${data.prime}</td>
                                <td>${data.phaseDegrees.toFixed(1)}°</td>
                                <td>${data.amplitude.toFixed(4)}</td>
                                <td>${data.realContribution.toFixed(4)}</td>
                                <td>${data.imagContribution.toFixed(4)}</td>
                                <td>${data.magnitude.toFixed(4)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            primeInfo.innerHTML = tableHTML;
        }

        // Initialize with default computation
        window.addEventListener('load', () => {
            computePhaselaw();
            visualizePhases();
            
            // Add event listeners for real-time updates
            document.getElementById('maxPrime').addEventListener('input', visualizePhases);
            document.getElementById('vizMode').addEventListener('change', visualizePhases);
            document.getElementById('alpha').addEventListener('input', () => {
                visualizePhases();
                if (document.getElementById('mode').value === 'single') {
                    computePhaselaw();
                }
            });
        });
    </script>
</body>
</html>
