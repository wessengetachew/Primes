<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Research by Wessen Getachew Summer 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 5px;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-group label {
            font-weight: 600;
            color: #555;
        }

        .input-group input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            min-width: 120px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .result-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .formula-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .export-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .status {
            font-weight: 600;
            margin: 10px 0;
        }

        .status.computing { color: #ffa500; }
        .status.complete { color: #28a745; }
        .status.error { color: #dc3545; }

        .math-display {
            font-size: 1.1em;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            font-family: 'Times New Roman', serif;
        }

        .explanation {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prime Research Explorer</h1>
            <p><strong>by Wessen Getachew</strong></p>
            <p>Summer 2025</p>
            <div class="math-display">
                Identity: (p-1)(p-2)/p² = (1-1/(p-1)²)(1-1/p)³
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('identity')">Identity Explorer</button>
            <button class="nav-tab" onclick="showTab('computation')">Prime Products</button>
            <button class="nav-tab" onclick="showTab('analysis')">Asymptotic Analysis</button>
            <button class="nav-tab" onclick="showTab('comparison')">Telescoping vs Primes</button>
            <button class="nav-tab" onclick="showTab('theory')">Theory & Applications</button>
        </div>

        <!-- Identity Explorer Tab -->
        <div id="identity" class="tab-content active">
            <h2>Identity Verification</h2>
            <div class="explanation">
                <h3>The Core Identity</h3>
                <p>We explore the algebraic identity that works for any real number p ≠ 0, 1:</p>
                <div class="math-display">
                    <strong>(p-1)(p-2)/p² = (1-1/(p-1)²)(1-1/p)³</strong>
                </div>
            </div>

            <div class="input-group">
                <label for="testValue">Test Value (p):</label>
                <input type="number" id="testValue" value="5" step="0.1">
                <button class="btn btn-primary" onclick="verifyIdentity()">Verify Identity</button>
            </div>

            <div id="identityResults"></div>

            <div class="formula-box">
                <h3>Step-by-Step Verification:</h3>
                <div id="stepByStep"></div>
            </div>
        </div>

        <!-- Prime Products Tab -->
        <div id="computation" class="tab-content">
            <h2>Prime Product Computation</h2>
            <div class="explanation">
                <h3>Finite Prime Products</h3>
                <p>Compute the product ∏(p-1)(p-2)/p² over primes in a range and see its factorization into twin and Mertens components.</p>
            </div>

            <div class="input-group">
                <label for="startPrime">Start Prime:</label>
                <input type="number" id="startPrime" value="3" min="3">
                <label for="endPrime">End Prime:</label>
                <input type="number" id="endPrime" value="100" min="3">
                <button class="btn btn-primary" onclick="computePrimeProduct()">Compute</button>
                <button class="btn btn-secondary" onclick="exportResults('computation')">Export Results</button>
            </div>

            <div class="progress-bar" id="computeProgress" style="display: none;">
                <div class="progress-fill" id="computeProgressFill"></div>
            </div>
            <div class="status" id="computeStatus"></div>

            <div id="primeResults"></div>

            <div class="chart-container" id="primeChart" style="display: none;">
                <canvas id="primeCanvas" width="800" height="400"></canvas>
            </div>
        </div>

        <!-- Asymptotic Analysis Tab -->
        <div id="analysis" class="tab-content">
            <h2>Asymptotic Behavior</h2>
            <div class="explanation">
                <h3>Growth Analysis</h3>
                <p>Study how the prime products behave asymptotically and compare with theoretical predictions.</p>
            </div>

            <div class="input-group">
                <label for="maxRange">Maximum Range:</label>
                <input type="number" id="maxRange" value="1000" min="10">
                <label for="numPoints">Number of Points:</label>
                <input type="number" id="numPoints" value="20" min="5" max="50">
                <button class="btn btn-primary" onclick="analyzeAsymptotics()">Analyze</button>
                <button class="btn btn-secondary" onclick="exportResults('analysis')">Export Analysis</button>
            </div>

            <div class="progress-bar" id="analysisProgress" style="display: none;">
                <div class="progress-fill" id="analysisProgressFill"></div>
            </div>
            <div class="status" id="analysisStatus"></div>

            <div id="asymptoticResults"></div>

            <div class="chart-container" id="asymptoticChart" style="display: none;">
                <canvas id="asymptoticCanvas" width="800" height="400"></canvas>
            </div>
        </div>

        <!-- Comparison Tab -->
        <div id="comparison" class="tab-content">
            <h2>Telescoping: Integers vs Primes</h2>
            <div class="explanation">
                <h3>Key Distinction</h3>
                <p>Understand why the identity telescopes for consecutive integers but not for primes.</p>
            </div>

            <div class="input-group">
                <label for="comparisonN">Upper Limit (n):</label>
                <input type="number" id="comparisonN" value="20" min="3">
                <button class="btn btn-primary" onclick="compareTelescopingVsPrimes()">Compare</button>
                <button class="btn btn-secondary" onclick="exportResults('comparison')">Export Comparison</button>
            </div>

            <div id="comparisonResults"></div>
        </div>

        <!-- Theory Tab -->
        <div id="theory" class="tab-content">
            <h2>Theoretical Background & Applications</h2>
            
            <div class="explanation">
                <h3>Mathematical Context</h3>
                <p>Explore the connections to twin prime research, Hardy-Littlewood constants, and Mertens' theorem.</p>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <h3>Hardy-Littlewood Twin Constant</h3>
                    <div class="value">C₂ ≈ 0.66016</div>
                    <p>The infinite product ∏(1-1/(p-1)²) over all odd primes.</p>
                </div>
                
                <div class="result-card">
                    <h3>Mertens' Constant</h3>
                    <div class="value">e^(-γ) ≈ 0.56146</div>
                    <p>Related to the asymptotic behavior of ∏(1-1/p).</p>
                </div>
                
                <div class="result-card">
                    <h3>Asymptotic Decay</h3>
                    <div class="value">∼ (log y)^(-3)</div>
                    <p>The prime product decays cubically due to Mertens factors.</p>
                </div>
                
                <div class="result-card">
                    <h3>Applications</h3>
                    <div class="value">Sieve Theory</div>
                    <p>Useful for twin prime research and computational number theory.</p>
                </div>
            </div>

            <div class="formula-box">
                <h3>Key Formulas:</h3>
                <p><strong>Main Identity:</strong> (p-1)(p-2)/p² = (1-1/(p-1)²)(1-1/p)³</p>
                <p><strong>Prime Product:</strong> ∏(p-1)(p-2)/p² = C_twin(y) × [M(y)]³</p>
                <p><strong>Telescoping (integers):</strong> ∏(k-1)(k-2)/k² = 4/(n²(n-1))</p>
                <p><strong>Asymptotic:</strong> R_modular(y) ∼ 2C₂e^(-3γ)/(log y)³</p>
            </div>

            <div class="input-group">
                <button class="btn btn-secondary" onclick="exportResults('theory')">Export Theory Summary</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables for storing results
        let currentResults = {};
        let computationHistory = [];

        // Utility functions
        function isPrime(n) {
            if (n < 2) return false;
            if (n === 2) return true;
            if (n % 2 === 0) return false;
            for (let i = 3; i <= Math.sqrt(n); i += 2) {
                if (n % i === 0) return false;
            }
            return true;
        }

        function getPrimesUpTo(limit) {
            const primes = [];
            for (let i = 2; i <= limit; i++) {
                if (isPrime(i)) primes.push(i);
            }
            return primes;
        }

        function formatNumber(num, precision = 10) {
            if (Math.abs(num) < 1e-15) return "0";
            if (Math.abs(num) > 1e10 || Math.abs(num) < 1e-6) {
                return num.toExponential(precision);
            }
            return num.toPrecision(precision);
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Identity verification
        function verifyIdentity() {
            const p = parseFloat(document.getElementById('testValue').value);
            
            if (p === 0 || p === 1) {
                alert('Please choose p ≠ 0, 1');
                return;
            }

            // Left side: (p-1)(p-2)/p²
            const leftSide = (p - 1) * (p - 2) / (p * p);

            // Right side: (1-1/(p-1)²)(1-1/p)³
            const term1 = 1 - 1 / ((p - 1) * (p - 1));
            const term2 = Math.pow(1 - 1/p, 3);
            const rightSide = term1 * term2;

            const difference = Math.abs(leftSide - rightSide);
            const isValid = difference < 1e-12;

            currentResults.identity = {
                p: p,
                leftSide: leftSide,
                rightSide: rightSide,
                difference: difference,
                isValid: isValid
            };

            displayIdentityResults();
            displayStepByStep(p, leftSide, rightSide, term1, term2);
        }

        function displayIdentityResults() {
            const result = currentResults.identity;
            const html = `
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Test Value</h3>
                        <div class="value">p = ${result.p}</div>
                    </div>
                    <div class="result-card">
                        <h3>Left Side</h3>
                        <div class="value">${formatNumber(result.leftSide)}</div>
                        <p>(p-1)(p-2)/p²</p>
                    </div>
                    <div class="result-card">
                        <h3>Right Side</h3>
                        <div class="value">${formatNumber(result.rightSide)}</div>
                        <p>(1-1/(p-1)²)(1-1/p)³</p>
                    </div>
                    <div class="result-card">
                        <h3>Verification</h3>
                        <div class="value" style="color: ${result.isValid ? '#28a745' : '#dc3545'}">
                            ${result.isValid ? '✓ VALID' : '✗ INVALID'}
                        </div>
                        <p>Difference: ${formatNumber(result.difference)}</p>
                    </div>
                </div>
            `;
            document.getElementById('identityResults').innerHTML = html;
        }

        function displayStepByStep(p, leftSide, rightSide, term1, term2) {
            const html = `
                <p><strong>For p = ${p}:</strong></p>
                <p>Left side: (${p}-1)(${p}-2)/${p}² = ${p-1} × ${p-2} / ${p*p} = ${formatNumber(leftSide)}</p>
                <p>Right side breakdown:</p>
                <p>  • First term: 1 - 1/(${p}-1)² = 1 - 1/${(p-1)*(p-1)} = ${formatNumber(term1)}</p>
                <p>  • Second term: (1 - 1/${p})³ = (${formatNumber(1-1/p)})³ = ${formatNumber(term2)}</p>
                <p>  • Product: ${formatNumber(term1)} × ${formatNumber(term2)} = ${formatNumber(rightSide)}</p>
                <p><strong>Result:</strong> Both sides equal ${formatNumber(leftSide)} ✓</p>
            `;
            document.getElementById('stepByStep').innerHTML = html;
        }

        // Prime product computation
        async function computePrimeProduct() {
            const start = parseInt(document.getElementById('startPrime').value);
            const end = parseInt(document.getElementById('endPrime').value);

            if (start < 3 || end < start) {
                alert('Please enter valid prime range (start ≥ 3, end ≥ start)');
                return;
            }

            // Show progress
            document.getElementById('computeProgress').style.display = 'block';
            document.getElementById('computeStatus').textContent = 'Computing prime products...';
            document.getElementById('computeStatus').className = 'status computing';

            const primes = getPrimesUpTo(end).filter(p => p >= start);
            
            let product = 1;
            let twinProduct = 1;
            let mertensProduct = 1;
            let logSum = 0;
            let logTwinSum = 0;
            let logMertensSum = 0;

            const results = [];

            for (let i = 0; i < primes.length; i++) {
                const p = primes[i];
                
                const term = (p - 1) * (p - 2) / (p * p);
                const twinTerm = 1 - 1 / ((p - 1) * (p - 1));
                const mertensTerm = 1 - 1 / p;

                // Use logarithms for numerical stability
                logSum += Math.log(term);
                logTwinSum += Math.log(twinTerm);
                logMertensSum += Math.log(mertensTerm);

                product = Math.exp(logSum);
                twinProduct = Math.exp(logTwinSum);
                mertensProduct = Math.exp(logMertensSum);

                results.push({
                    prime: p,
                    term: term,
                    product: product,
                    twinProduct: twinProduct,
                    mertensProduct: mertensProduct,
                    mertensCubed: Math.pow(mertensProduct, 3),
                    factorization: twinProduct * Math.pow(mertensProduct, 3)
                });

                // Update progress
                const progress = ((i + 1) / primes.length) * 100;
                document.getElementById('computeProgressFill').style.width = progress + '%';
                
                // Allow UI updates
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 1));
                }
            }

            currentResults.primeProduct = {
                start: start,
                end: end,
                primes: primes,
                results: results,
                finalProduct: product,
                finalTwinProduct: twinProduct,
                finalMertensProduct: mertensProduct,
                rModular: product / 4
            };

            document.getElementById('computeStatus').textContent = 'Computation complete!';
            document.getElementById('computeStatus').className = 'status complete';
            document.getElementById('computeProgress').style.display = 'none';

            displayPrimeResults();
        }

        function displayPrimeResults() {
            const result = currentResults.primeProduct;
            const final = result.results[result.results.length - 1];

            const summaryHtml = `
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Prime Range</h3>
                        <div class="value">${result.start} to ${result.end}</div>
                        <p>${result.primes.length} primes found</p>
                    </div>
                    <div class="result-card">
                        <h3>Final Product</h3>
                        <div class="value">${formatNumber(result.finalProduct)}</div>
                        <p>∏(p-1)(p-2)/p²</p>
                    </div>
                    <div class="result-card">
                        <h3>Twin Factor</h3>
                        <div class="value">${formatNumber(result.finalTwinProduct)}</div>
                        <p>C_twin(${result.end})</p>
                    </div>
                    <div class="result-card">
                        <h3>Mertens³ Factor</h3>
                        <div class="value">${formatNumber(Math.pow(result.finalMertensProduct, 3))}</div>
                        <p>[M(${result.end})]³</p>
                    </div>
                    <div class="result-card">
                        <h3>Factorization Check</h3>
                        <div class="value" style="color: #28a745">✓ VERIFIED</div>
                        <p>Product = Twin × Mertens³</p>
                    </div>
                    <div class="result-card">
                        <h3>R_modular(y)</h3>
                        <div class="value">${formatNumber(result.rModular)}</div>
                        <p>Product / 4</p>
                    </div>
                </div>
            `;

            // Create detailed table
            let tableHtml = `
                <h3>Detailed Results by Prime</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Prime p</th>
                            <th>(p-1)(p-2)/p²</th>
                            <th>Running Product</th>
                            <th>Twin Factor</th>
                            <th>Mertens Factor</th>
                            <th>Verification</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const row of result.results.slice(-20)) { // Show last 20 for performance
                const verification = Math.abs(row.product - row.factorization) < 1e-10 ? '✓' : '✗';
                tableHtml += `
                    <tr>
                        <td>${row.prime}</td>
                        <td>${formatNumber(row.term, 6)}</td>
                        <td>${formatNumber(row.product, 6)}</td>
                        <td>${formatNumber(row.twinProduct, 6)}</td>
                        <td>${formatNumber(row.mertensProduct, 6)}</td>
                        <td style="color: ${verification === '✓' ? '#28a745' : '#dc3545'}">${verification}</td>
                    </tr>
                `;
            }

            tableHtml += '</tbody></table>';

            document.getElementById('primeResults').innerHTML = summaryHtml + tableHtml;
        }

        // Asymptotic analysis
        async function analyzeAsymptotics() {
            const maxRange = parseInt(document.getElementById('maxRange').value);
            const numPoints = parseInt(document.getElementById('numPoints').value);

            document.getElementById('analysisProgress').style.display = 'block';
            document.getElementById('analysisStatus').textContent = 'Computing asymptotic behavior...';
            document.getElementById('analysisStatus').className = 'status computing';

            const points = [];
            const step = Math.floor(maxRange / numPoints);

            for (let i = 1; i <= numPoints; i++) {
                const y = Math.max(10, i * step);
                const primes = getPrimesUpTo(y).filter(p => p >= 3);
                
                let logSum = 0;
                let logTwinSum = 0;
                let logMertensSum = 0;

                for (const p of primes) {
                    logSum += Math.log((p - 1) * (p - 2) / (p * p));
                    logTwinSum += Math.log(1 - 1 / ((p - 1) * (p - 1)));
                    logMertensSum += Math.log(1 - 1 / p);
                }

                const product = Math.exp(logSum);
                const twinProduct = Math.exp(logTwinSum);
                const mertensProduct = Math.exp(logMertensSum);
                const rModular = product / 4;

                // Theoretical asymptotic: 2 * C2 * e^(-3γ) / (log y)^3
                const gamma = 0.5772156649015329; // Euler-Mascheroni constant
                const C2 = 0.6601618158468695; // Hardy-Littlewood twin constant (approximate)
                const theoretical = 2 * C2 * Math.exp(-3 * gamma) / Math.pow(Math.log(y), 3);

                points.push({
                    y: y,
                    numPrimes: primes.length,
                    product: product,
                    twinProduct: twinProduct,
                    mertensProduct: mertensProduct,
                    rModular: rModular,
                    theoretical: theoretical,
                    ratio: rModular / theoretical,
                    logY: Math.log(y),
                    logProduct: Math.log(rModular)
                });

                // Update progress
                const progress = (i / numPoints) * 100;
                document.getElementById('analysisProgressFill').style.width = progress + '%';
                
                // Allow UI updates
                if (i % 5 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 1));
                }
            }

            currentResults.asymptotic = {
                maxRange: maxRange,
                numPoints: numPoints,
                points: points
            };

            document.getElementById('analysisStatus').textContent = 'Analysis complete!';
            document.getElementById('analysisStatus').className = 'status complete';
            document.getElementById('analysisProgress').style.display = 'none';

            displayAsymptoticResults();
        }

        function displayAsymptoticResults() {
            const result = currentResults.asymptotic;
            const lastPoint = result.points[result.points.length - 1];

            const summaryHtml = `
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Range Analyzed</h3>
                        <div class="value">3 to ${result.maxRange}</div>
                        <p>${result.numPoints} data points</p>
                    </div>
                    <div class="result-card">
                        <h3>Final R_modular</h3>
                        <div class="value">${formatNumber(lastPoint.rModular)}</div>
                        <p>At y = ${lastPoint.y}</p>
                    </div>
                    <div class="result-card">
                        <h3>Theoretical Prediction</h3>
                        <div class="value">${formatNumber(lastPoint.theoretical)}</div>
                        <p>2C₂e^(-3γ)/(log y)³</p>
                    </div>
                    <div class="result-card">
                        <h3>Ratio (Actual/Theory)</h3>
                        <div class="value">${formatNumber(lastPoint.ratio, 6)}</div>
                        <p>Convergence indicator</p>
                    </div>
                </div>
            `;

            // Create asymptotic table
            let tableHtml = `
                <h3>Asymptotic Behavior Analysis</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Upper Limit y</th>
                            <th># Primes</th>
                            <th>R_modular(y)</th>
                            <th>Theoretical</th>
                            <th>Ratio</th>
                            <th>log y</th>
                            <th>(log y)³</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const point of result.points) {
                const logYCubed = Math.pow(point.logY, 3);
                tableHtml += `
                    <tr>
                        <td>${point.y}</td>
                        <td>${point.numPrimes}</td>
                        <td>${formatNumber(point.rModular, 6)}</td>
                        <td>${formatNumber(point.theoretical, 6)}</td>
                        <td>${formatNumber(point.ratio, 4)}</td>
                        <td>${formatNumber(point.logY, 4)}</td>
                        <td>${formatNumber(logYCubed, 4)}</td>
                    </tr>
                `;
            }

            tableHtml += '</tbody></table>';

            document.getElementById('asymptoticResults').innerHTML = summaryHtml + tableHtml;
            
            // Show chart container
            document.getElementById('asymptoticChart').style.display = 'block';
            drawAsymptoticChart();
        }

        function drawAsymptoticChart() {
            const canvas = document.getElementById('asymptoticCanvas');
            const ctx = canvas.getContext('2d');
            const points = currentResults.asymptotic.points;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Set up chart dimensions
            const padding = 60;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;

            // Find data ranges
            const xValues = points.map(p => p.logY);
            const yValues = points.map(p => Math.log(p.rModular));
            const theoreticalValues = points.map(p => Math.log(p.theoretical));

            const xMin = Math.min(...xValues);
            const xMax = Math.max(...xValues);
            const yMin = Math.min(...yValues, ...theoreticalValues);
            const yMax = Math.max(...yValues, ...theoreticalValues);

            // Helper function to convert data to canvas coordinates
            function toCanvasX(x) {
                return padding + (x - xMin) / (xMax - xMin) * chartWidth;
            }

            function toCanvasY(y) {
                return padding + (yMax - y) / (yMax - yMin) * chartHeight;
            }

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // Draw actual data
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i < points.length; i++) {
                const x = toCanvasX(points[i].logY);
                const y = toCanvasY(Math.log(points[i].rModular));
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Draw theoretical prediction
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            for (let i = 0; i < points.length; i++) {
                const x = toCanvasX(points[i].logY);
                const y = toCanvasY(Math.log(points[i].theoretical));
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // Add labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('log y', canvas.width / 2, canvas.height - 20);
            
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('log(R_modular)', 0, 0);
            ctx.restore();

            // Add legend
            ctx.fillStyle = '#667eea';
            ctx.fillRect(canvas.width - 150, 30, 20, 3);
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Actual', canvas.width - 125, 35);

            ctx.fillStyle = '#764ba2';
            ctx.fillRect(canvas.width - 150, 50, 20, 3);
            ctx.fillText('Theoretical', canvas.width - 125, 55);
        }

        // Telescoping comparison
        function compareTelescopingVsPrimes() {
            const n = parseInt(document.getElementById('comparisonN').value);

            if (n < 3) {
                alert('Please enter n ≥ 3');
                return;
            }

            // Consecutive integers telescoping
            const integerProduct = 4 / (n * n * (n - 1));
            
            // Step-by-step for integers
            let integerStepProduct = 1;
            const integerSteps = [];
            for (let k = 3; k <= n; k++) {
                const term = (k - 1) * (k - 2) / (k * k);
                integerStepProduct *= term;
                integerSteps.push({
                    k: k,
                    term: term,
                    product: integerStepProduct
                });
            }

            // Prime product (no telescoping)
            const primes = getPrimesUpTo(n).filter(p => p >= 3);
            let primeProduct = 1;
            let primeTwinProduct = 1;
            let primeMertensProduct = 1;
            const primeSteps = [];

            for (const p of primes) {
                const term = (p - 1) * (p - 2) / (p * p);
                const twinTerm = 1 - 1 / ((p - 1) * (p - 1));
                const mertensTerm = 1 - 1 / p;

                primeProduct *= term;
                primeTwinProduct *= twinTerm;
                primeMertensProduct *= mertensTerm;

                primeSteps.push({
                    p: p,
                    term: term,
                    product: primeProduct,
                    twinProduct: primeTwinProduct,
                    mertensProduct: primeMertensProduct
                });
            }

            currentResults.comparison = {
                n: n,
                integerProduct: integerProduct,
                integerStepProduct: integerStepProduct,
                integerSteps: integerSteps,
                primes: primes,
                primeProduct: primeProduct,
                primeTwinProduct: primeTwinProduct,
                primeMertensProduct: primeMertensProduct,
                primeSteps: primeSteps
            };

            displayComparisonResults();
        }

        function displayComparisonResults() {
            const result = currentResults.comparison;

            const summaryHtml = `
                <div class="comparison-grid">
                    <div class="result-card">
                        <h3>Consecutive Integers (3 to ${result.n})</h3>
                        <div class="value">${formatNumber(result.integerProduct)}</div>
                        <p><strong>Telescopes to:</strong> 4/(n²(n-1))</p>
                        <p><strong>Step-by-step product:</strong> ${formatNumber(result.integerStepProduct)}</p>
                        <p style="color: ${Math.abs(result.integerProduct - result.integerStepProduct) < 1e-12 ? '#28a745' : '#dc3545'}">
                            ${Math.abs(result.integerProduct - result.integerStepProduct) < 1e-12 ? '✓ Perfect match' : '✗ Mismatch'}
                        </p>
                    </div>
                    <div class="result-card">
                        <h3>Primes Only (up to ${result.n})</h3>
                        <div class="value">${formatNumber(result.primeProduct)}</div>
                        <p><strong>No telescoping formula</strong></p>
                        <p><strong>Primes used:</strong> ${result.primes.join(', ')}</p>
                        <p><strong>Factorization:</strong> Twin × Mertens³</p>
                    </div>
                </div>

                <div class="explanation">
                    <h3>Why the Difference?</h3>
                    <p><strong>Consecutive Integers:</strong> The product telescopes because adjacent terms like (k-1)/k cancel across consecutive values.</p>
                    <p><strong>Primes Only:</strong> Since primes skip most integers, there's no consecutive cancellation. The identity reveals the structure but doesn't telescope to a simple formula.</p>
                </div>
            `;

            // Detailed comparison table
            let tableHtml = `
                <h3>Step-by-Step Comparison</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Consecutive Integers</h4>
                        <table class="data-table">
                            <thead>
                                <tr><th>k</th><th>(k-1)(k-2)/k²</th><th>Running Product</th></tr>
                            </thead>
                            <tbody>
            `;

            for (const step of result.integerSteps) {
                tableHtml += `
                    <tr>
                        <td>${step.k}</td>
                        <td>${formatNumber(step.term, 6)}</td>
                        <td>${formatNumber(step.product, 6)}</td>
                    </tr>
                `;
            }

            tableHtml += `
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <h4>Primes Only</h4>
                        <table class="data-table">
                            <thead>
                                <tr><th>p</th><th>(p-1)(p-2)/p²</th><th>Running Product</th></tr>
                            </thead>
                            <tbody>
            `;

            for (const step of result.primeSteps) {
                tableHtml += `
                    <tr>
                        <td>${step.p}</td>
                        <td>${formatNumber(step.term, 6)}</td>
                        <td>${formatNumber(step.product, 6)}</td>
                    </tr>
                `;
            }

            tableHtml += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('comparisonResults').innerHTML = summaryHtml + tableHtml;
        }

        // Export functionality
        function exportResults(section) {
            let data = {};
            let filename = '';

            switch (section) {
                case 'computation':
                    data = currentResults.primeProduct;
                    filename = `prime_product_${data?.start || 'unknown'}_to_${data?.end || 'unknown'}.json`;
                    break;
                case 'analysis':
                    data = currentResults.asymptotic;
                    filename = `asymptotic_analysis_${data?.maxRange || 'unknown'}.json`;
                    break;
                case 'comparison':
                    data = currentResults.comparison;
                    filename = `telescoping_comparison_n${data?.n || 'unknown'}.json`;
                    break;
                case 'theory':
                    data = {
                        title: "Prime Research Theory Summary",
                        author: "Wessen Getachew",
                        date: "Summer 2025",
                        identity: "(p-1)(p-2)/p² = (1-1/(p-1)²)(1-1/p)³",
                        applications: [
                            "Twin prime research",
                            "Sieve theory",
                            "Computational number theory",
                            "Asymptotic analysis"
                        ],
                        constants: {
                            "Hardy-Littlewood C2": 0.66016,
                            "Euler-Mascheroni gamma": 0.5772156649,
                            "e^(-gamma)": 0.56146
                        },
                        keyResults: [
                            "Identity valid for all p ≠ 0,1",
                            "Telescoping works for consecutive integers only",
                            "Prime products decay as (log y)^(-3)",
                            "Clean factorization into twin and Mertens factors"
                        ]
                    };
                    filename = 'prime_research_theory_summary.json';
                    break;
                default:
                    alert('No data to export');
                    return;
            }

            if (!data || Object.keys(data).length === 0) {
                alert('No data available to export. Please run the computation first.');
                return;
            }

            // Add metadata
            const exportData = {
                metadata: {
                    title: "Prime Research by Wessen Getachew",
                    date: new Date().toISOString(),
                    section: section,
                    identity: "(p-1)(p-2)/p² = (1-1/(p-1)²)(1-1/p)³"
                },
                data: data
            };

            // Create and download file
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(`Results exported as ${filename}`);
        }

        // Initialize with identity verification for p=5
        window.onload = function() {
            document.getElementById('testValue').value = '5';
            verifyIdentity();
        };
    </script>
</body>
</html>
